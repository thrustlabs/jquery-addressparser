!function(){var $,__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++){if(i in this&&this[i]===item)return i}return-1};this.AddressParser=function(){var americanStates,canadianProvinces;function AddressParser(){}canadianProvinces={"british columbia":"BC",bc:"BC",alberta:"AB",ab:"AB",saskatchewan:"sk",sk:"SK",manitoba:"MB",mb:"MB",ontario:"ON",on:"ON",quebec:"QC",qc:"QC",newfoundland:"NL","newfoundland and labrador":"NL","newfoundland and labrador":"NL",labrador:"NL",nl:"NL","new brunswick":"NB",nb:"NB","prince edward island":"PE",PEI:"PE",pe:"PE","nova scotia":"NS",ns:"NS","yukon territories":"YT",yukon:"YT",yt:"YT","northwest territories":"NT",nt:"NT",nunavut:"NU",nu:"NU"};americanStates={alabama:"AL",al:"AL",alaska:"AK",ak:"AK","american samoa":"AS",as:"AS",arizona:"AZ",az:"AZ",arkansas:"AR",ar:"AR",california:"CA",ca:"CA",colorado:"CO",co:"CO",connecticut:"CT",ct:"CT",delaware:"DE",de:"DE","district of columbia":"DC","d.c.":"DC",dc:"DC","federated states of micronesia":"FM",fm:"FM",florida:"FL",fl:"FL",georgia:"GA",ga:"GA",guam:"GU",gu:"GU",hawaii:"HI",hi:"HI",idaho:"ID",id:"ID",illinois:"IL",il:"IL",indiana:"IN","in":"IN",iowa:"IA",ia:"IA",kansas:"KS",ks:"KS",kentucky:"KY",ky:"KY",louisiana:"LA",la:"LA",maine:"ME",me:"ME","marshall islands":"MH",mh:"MH",maryland:"MD",md:"MD",massachusetts:"MA",ma:"MA",michigan:"MI",mi:"MI",minnesota:"MN",mn:"MN",mississippi:"MS",ms:"MS",missouri:"MO",mo:"MO",montana:"MT",mt:"MT",nebraska:"NE",ne:"NE",nevada:"NV",nv:"NV","new hampshire":"NH",nh:"NH","new jersey":"NJ",nj:"NJ","new mexico":"NM",nm:"NM","new york":"NY",ny:"NY","north carolina":"NC",nc:"NC","north dakota":"ND",nd:"ND","northern mariana islands":"MP",mp:"MP",ohio:"OH",oh:"OH",oklahoma:"OK",ok:"OK",oregon:"OR",or:"OR",palau:"PW",pw:"PW",pennsylvania:"PA",pa:"PA","puerto rico":"PR",pr:"PR","rhode island":"RI",ri:"RI","south carolina":"SC",sc:"SC","south dakota":"SD",sd:"SD",tennessee:"TN",tn:"TN",texas:"TX",tx:"TX",utah:"UT",ut:"UT",vermont:"VT",vt:"VT","virgin islands":"VI",vi:"VI",virginia:"VA",va:"VA",washington:"WA",wa:"WA","west virginia":"WV",wv:"WV",wisconsin:"WI",wi:"WI",wyoming:"WY",wy:"WY"};AddressParser.prototype.parse=function(address){var addressRegex,canadianPostalRegex,emailRegex,extraInfo,field,fields,i,indexes,matches,phoneRegex,streetNameRegex,trim,usZipRegex,usedFields,websiteRegex,_i,_len,_ref,_results;this.name="";this.email="";this.province="";this.country="";this.address="";this.postal="";this.website="";this.phone="";indexes={};usedFields=[];trim=function(txt){return txt.replace(/^\s+|\s+$/g,"")};canadianPostalRegex=/[a-z]\d[a-z]\s*\d[a-z]\d/i;usZipRegex=/\d\d\d\d\d/;emailRegex=/(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))/;websiteRegex=/(http|www)\S+/;streetNameRegex=/\s(dr\.{0,1}|drive|st\.{0,1}|street)(\s|$)/i;phoneRegex=/(\d\d\d)[ \-\.](\d\d\d)[ \-\.](\d\d\d\d)/;if(canadianPostalRegex.test(address)){matches=address.match(canadianPostalRegex);this.postal=matches[0];address=address.replace(matches[0],",")}if(usZipRegex.test(address)){matches=address.match(usZipRegex);this.postal=matches[0];address=address.replace(matches[0],",")}fields=address.split(/\s*[,\n\|]\s*/);this.name=trim(fields[0]);fields.shift;addressRegex=/^\d+\s+\D+/;for(i=_i=0,_len=fields.length;_i<_len;i=++_i){field=fields[i];field=trim(field);if(emailRegex.test(field)){this.email=field;indexes["email"]=i;usedFields.push(i)}else if(phoneRegex.test(field)){matches=phoneRegex.exec(field);this.phone="("+matches[1]+") "+matches[2]+"-"+matches[3];indexes["phone"]=i;usedFields.push(i)}else if(addressRegex.test(field)){this.address=field;indexes["address"]=i;usedFields.push(i);matches=this.address.match(streetNameRegex);if(matches){if(this.address.indexOf(matches[0])<this.address.length-matches[0].length-1){extraInfo=this.address.substring(this.address.indexOf(matches[0])+matches[0].length);this.city=trim(extraInfo);this.address=this.address.substring(0,this.address.indexOf(matches[0])+matches[0].length-1)}}}else if(websiteRegex.test(field)){this.website=field;if(this.website.indexOf("http")!==0){this.website="http://"+this.website}indexes["website"]=i;usedFields.push(i)}else if(field.toLowerCase()in canadianProvinces){this.province=canadianProvinces[field.toLowerCase()];this.country="Canada";indexes["province"]=i;usedFields.push(i)}else if(field.toLowerCase()in americanStates){this.province=americanStates[field.toLowerCase()];this.country="USA";indexes["province"]=i;usedFields.push(i)}}if(!this.city&&indexes["province"]){this.city=trim(fields[indexes["province"]-1]);usedFields.push(indexes["province"]-1)}if(indexes["address"]){i=indexes["address"];_results=[];while(i+1<=fields.length&&(_ref=i+1,__indexOf.call(usedFields,_ref)<0)){i++;if(trim(fields[i])!==""){_results.push(this.address=""+this.address+", "+trim(fields[i]))}else{_results.push(void 0)}}return _results}};return AddressParser}();$=jQuery;$.fn.extend({addressparser:function(options){var opts,self;self=$.fn.addressparser;opts=$.extend({},self.default_options,options);return $(this).each(function(i,el){return self.init(el,opts)})}});$.extend($.fn.addressparser,{opts:{},default_options:{},init:function(el,opts){self.opts=opts;return $(el).bind("input propertychange",function(){var parser;parser=new AddressParser;parser.parse($(this).val());if(opts.name){$(opts.name).val(parser.name)}if(opts.address){$(opts.address).val(parser.address)}if(opts.city){$(opts.city).val(parser.city)}if(opts.province){$(opts.province).val(parser.province)}if(opts.postal){$(opts.postal).val(parser.postal)}if(opts.country){$(opts.country).val(parser.country)}if(opts.phone){$(opts.phone).val(parser.phone)}if(opts.email){$(opts.email).val(parser.email)}if(opts.website){return $(opts.website).val(parser.website)}})}})}.call(this);